{"uid":"f0e71882da0527a5","name":"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览","fullName":"aircases.test_ai_history.air.test_ai_history#test_ai_history_file_open","historyId":"cdc1b3b264e97dd88af65122ab03ee93","time":{"start":1750990551575,"stop":1750990598321,"duration":46746},"description":"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览","descriptionHtml":"<p>点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览</p>\n","status":"broken","statusMessage":"poco.exceptions.PocoNoSuchNodeException: Cannot find any visible node by query UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"","statusTrace":"proxy = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\nargs = (), kwargs = {}\n\n    @wraps(func)\n    def wrapped(proxy, *args, **kwargs):\n        try:\n            return func(proxy, *args, **kwargs)\n        except PocoNoSuchNodeException as e:\n            try:\n>               proxy.wait_for_appearance(timeout=proxy.poco._pre_action_wait_for_appearance)\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:26: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\ntimeout = 6\n\n    def wait_for_appearance(self, timeout=120):\n        \"\"\"\n        Block and wait until the UI element **appears** within the given timeout. When timeout, the\n        :py:class:`PocoTargetTimeout <poco.exceptions.PocoTargetTimeout>` is raised.\n    \n        Args:\n            timeout: maximum waiting time in seconds\n    \n        Raises:\n            PocoTargetTimeout: when timeout\n        \"\"\"\n    \n        start = time.time()\n        while not self.exists():\n            self.poco.sleep_for_polling_interval()\n            if time.time() - start > timeout:\n>               raise PocoTargetTimeout('appearance', self)\nE               poco.exceptions.PocoTargetTimeout: Waiting timeout for appearance of \"UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\"\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:679: PocoTargetTimeout\n\nDuring handling of the above exception, another exception occurred:\n\n    @pytest.mark.testcase\n    @allure.description(\"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览\")\n    @allure.title(\"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览\")\n    def test_ai_history_file_open():\n        poco(\"AI助手\").click()\n        poco(\"文件输入\").click()\n        poco(text=\"文档\").click()\n        # 点击上传列表第一个文档\n        poco(\"android.widget.FrameLayout\") \\\n            .child(\"android.widget.LinearLayout\") \\\n            .offspring(\"com.android.documentsui:id/drawer_layout\") \\\n            .child(\"android.widget.ScrollView\") \\\n            .offspring(\"com.android.documentsui:id/container_directory\") \\\n            .offspring(\"com.android.documentsui:id/dir_list\") \\\n            .child(\"com.android.documentsui:id/item_root\")[0] \\\n            .child(\"android.widget.LinearLayout\") \\\n            .child(\"android.widget.LinearLayout\") \\\n            .offspring(\"android:id/title\").click()\n        # 点击预览文件\n        poco(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\")[2].offspring(\"文件\").click()\n        sleep(2)\n        # 关闭文件\n        if poco(\"cn.wps.moffice_eng:id/writer_maintoolbar_backBtn\").exists():\n            poco(\"cn.wps.moffice_eng:id/writer_maintoolbar_backBtn\").click()\n        else:\n            poco(\"cn.wps.moffice_eng:id/pdf_main_toolbar_backBtn\").click()\n        # 右滑返回\n        swipe((0, 778), (999, 778))\n        sleep(2)\n        # 点击键盘\n        poco(\"键盘输入\").click()\n        text(\"总结这个文档内容\", enter=False)\n        poco(\"分享\").click()\n        sleep(5)\n        # 返回\n        poco(\"返回\").click()\n        # 点击历史记录删除记录\n        poco(text=\"历史记录\").click()\n        sleep(1)\n        # 点击会话\n        poco(\"android.widget.LinearLayout\") \\\n            .offspring(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\").child(\"android.view.View\") \\\n            .child(\"android.view.View\")[1] \\\n            .child(\"android.view.View\")[0].click()\n        sleep(1)\n        # 点击打开文件\n        poco(\"android.widget.LinearLayout\") \\\n            .offspring(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\")[0].child(\"android.view.View\") \\\n>           .child(\"android.view.View\").click()\n\naircases\\test_ai_history.air\\test_ai_history.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n.venv\\Lib\\site-packages\\poco\\proxy.py:29: in wrapped\n    raise e\n.venv\\Lib\\site-packages\\poco\\proxy.py:23: in wrapped\n    return func(proxy, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:332: in click\n    pos_in_percentage = self.get_position(focus)\n.venv\\Lib\\site-packages\\poco\\proxy.py:72: in wrapped\n    return func(proxy, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:613: in get_position\n    x, y = map(float, self.attr('pos'))\n.venv\\Lib\\site-packages\\poco\\proxy.py:39: in wrapped\n    return func(self, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:734: in attr\n    nodes = self._do_query(multiple=False)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\nmultiple = False, refresh = False\n\n    def _do_query(self, multiple=True, refresh=False):\n        if not self._evaluated or refresh:\n            self._nodes = self.poco.agent.hierarchy.select(self.query, multiple)\n            if not self._nodes or len(self._nodes) == 0:\n                # 找不到节点时，将当前节点状态重置，强制下一次访问时重新查询一次节点信息\n                self.invalidate()\n>               raise PocoNoSuchNodeException(self)\nE               poco.exceptions.PocoNoSuchNodeException: Cannot find any visible node by query UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:888: PocoNoSuchNodeException","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览","status":"broken","statusMessage":"poco.exceptions.PocoNoSuchNodeException: Cannot find any visible node by query UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"","statusTrace":"proxy = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\nargs = (), kwargs = {}\n\n    @wraps(func)\n    def wrapped(proxy, *args, **kwargs):\n        try:\n            return func(proxy, *args, **kwargs)\n        except PocoNoSuchNodeException as e:\n            try:\n>               proxy.wait_for_appearance(timeout=proxy.poco._pre_action_wait_for_appearance)\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:26: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\ntimeout = 6\n\n    def wait_for_appearance(self, timeout=120):\n        \"\"\"\n        Block and wait until the UI element **appears** within the given timeout. When timeout, the\n        :py:class:`PocoTargetTimeout <poco.exceptions.PocoTargetTimeout>` is raised.\n    \n        Args:\n            timeout: maximum waiting time in seconds\n    \n        Raises:\n            PocoTargetTimeout: when timeout\n        \"\"\"\n    \n        start = time.time()\n        while not self.exists():\n            self.poco.sleep_for_polling_interval()\n            if time.time() - start > timeout:\n>               raise PocoTargetTimeout('appearance', self)\nE               poco.exceptions.PocoTargetTimeout: Waiting timeout for appearance of \"UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\"\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:679: PocoTargetTimeout\n\nDuring handling of the above exception, another exception occurred:\n\n    @pytest.mark.testcase\n    @allure.description(\"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览\")\n    @allure.title(\"点击历史会话的文件在云端时下载后点击直接打开，文件上传后预览\")\n    def test_ai_history_file_open():\n        poco(\"AI助手\").click()\n        poco(\"文件输入\").click()\n        poco(text=\"文档\").click()\n        # 点击上传列表第一个文档\n        poco(\"android.widget.FrameLayout\") \\\n            .child(\"android.widget.LinearLayout\") \\\n            .offspring(\"com.android.documentsui:id/drawer_layout\") \\\n            .child(\"android.widget.ScrollView\") \\\n            .offspring(\"com.android.documentsui:id/container_directory\") \\\n            .offspring(\"com.android.documentsui:id/dir_list\") \\\n            .child(\"com.android.documentsui:id/item_root\")[0] \\\n            .child(\"android.widget.LinearLayout\") \\\n            .child(\"android.widget.LinearLayout\") \\\n            .offspring(\"android:id/title\").click()\n        # 点击预览文件\n        poco(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\")[2].offspring(\"文件\").click()\n        sleep(2)\n        # 关闭文件\n        if poco(\"cn.wps.moffice_eng:id/writer_maintoolbar_backBtn\").exists():\n            poco(\"cn.wps.moffice_eng:id/writer_maintoolbar_backBtn\").click()\n        else:\n            poco(\"cn.wps.moffice_eng:id/pdf_main_toolbar_backBtn\").click()\n        # 右滑返回\n        swipe((0, 778), (999, 778))\n        sleep(2)\n        # 点击键盘\n        poco(\"键盘输入\").click()\n        text(\"总结这个文档内容\", enter=False)\n        poco(\"分享\").click()\n        sleep(5)\n        # 返回\n        poco(\"返回\").click()\n        # 点击历史记录删除记录\n        poco(text=\"历史记录\").click()\n        sleep(1)\n        # 点击会话\n        poco(\"android.widget.LinearLayout\") \\\n            .offspring(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\").child(\"android.view.View\") \\\n            .child(\"android.view.View\")[1] \\\n            .child(\"android.view.View\")[0].click()\n        sleep(1)\n        # 点击打开文件\n        poco(\"android.widget.LinearLayout\") \\\n            .offspring(\"androidx.compose.ui.platform.ComposeView\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\") \\\n            .child(\"android.view.View\")[0].child(\"android.view.View\") \\\n>           .child(\"android.view.View\").click()\n\naircases\\test_ai_history.air\\test_ai_history.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n.venv\\Lib\\site-packages\\poco\\proxy.py:29: in wrapped\n    raise e\n.venv\\Lib\\site-packages\\poco\\proxy.py:23: in wrapped\n    return func(proxy, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:332: in click\n    pos_in_percentage = self.get_position(focus)\n.venv\\Lib\\site-packages\\poco\\proxy.py:72: in wrapped\n    return func(proxy, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:613: in get_position\n    x, y = map(float, self.attr('pos'))\n.venv\\Lib\\site-packages\\poco\\proxy.py:39: in wrapped\n    return func(self, *args, **kwargs)\n.venv\\Lib\\site-packages\\poco\\proxy.py:734: in attr\n    nodes = self._do_query(multiple=False)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\nmultiple = False, refresh = False\n\n    def _do_query(self, multiple=True, refresh=False):\n        if not self._evaluated or refresh:\n            self._nodes = self.poco.agent.hierarchy.select(self.query, multiple)\n            if not self._nodes or len(self._nodes) == 0:\n                # 找不到节点时，将当前节点状态重置，强制下一次访问时重新查询一次节点信息\n                self.invalidate()\n>               raise PocoNoSuchNodeException(self)\nE               poco.exceptions.PocoNoSuchNodeException: Cannot find any visible node by query UIObjectProxy of \"android.widget.LinearLayout>androidx.compose.ui.platform.ComposeView/android.view.View/android.view.View/android.view.View[0]/android.view.View/android.view.View\"\n\n.venv\\Lib\\site-packages\\poco\\proxy.py:888: PocoNoSuchNodeException","steps":[],"attachments":[{"uid":"8baaf31ffb816927","name":"log","source":"8baaf31ffb816927.txt","type":"text/plain","size":233}],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"hasContent":true,"attachmentStep":false,"stepsCount":0},"afterStages":[],"labels":[{"name":"feature","value":"ai历史对话模块用例"},{"name":"epic","value":"办公本v2.4.0"},{"name":"tag","value":"testcase"},{"name":"parentSuite","value":"aircases.test_ai_history.air"},{"name":"suite","value":"test_ai_history"},{"name":"host","value":"DESKTOP-P9LT7L8"},{"name":"thread","value":"8036-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"aircases.test_ai_history.air.test_ai_history"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":["testcase"]},"source":"f0e71882da0527a5.json","parameterValues":[]}